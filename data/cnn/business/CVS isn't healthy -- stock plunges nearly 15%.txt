CVS investors might need some medication for nausea.

The drugstore chain and pharmacy benefits manager giant reported sales for the third quarter that missed forecasts. CVS (CVS) also warned that earnings for the fourth quarter and all of 2017 would be worse than expected.

Shares plunged nearly 15% on the news.

The biggest problem for CVS appears to be increased competition from rival Walgreens (WBA), which now owns European pharmacy giant Boots and is also in the process of buying Rite Aid (RAD).

CVS said that it expects to lose more than 40 million prescriptions.

Related: Canada's top pharmacy chain prepares to sell medical marijuana

CEO Larry Merlo said that some prescriptions have begun "migrating out of our pharmacies this quarter" and that the company is "currently experiencing slowing prescription growth in the overall market."

CVS bought pharmacy benefits manager Caremark a few years ago, a deal that may be backfiring on the company. CVS may be alienating some companies who are worried about how much power it holds in the prescription drug business.

Walgreens has sought to take advantage of those fears. It has partnered with Caremark rival Optum Rx, which is owned by insurance giant UnitedHealth (UNH).

Walgreens also has a strategic alliance with Prime Therapeutics, the mail order unit of more than a dozen Blue Cross and Blue Shield health plans.

Another pharmacy benefits manager, Express Scripts (ESRX), announced at the end of September that Walgreens will replace CVS as the drug store of choice for Tricare, a prescription plan that Express Scripts runs for members of the U.S. military.

Related: Target misses the mark, warns of weak sales ahead

CVS is trying to diversify its business to deal with these competitive threats. The company has also bought Omnicare, a company that runs pharmacies for nursing homes. CVS also now runs in-store pharmacies at Target. (TGT)

But many analysts believe that CVS has paid too much attention to its pharmacy benefits and mail order businesses -- at the expense of improving its own stores.

CVS said same-store sales at the front end of its pharmacies fell 1% in the quarter. The company blamed weak traffic.

Meanwhile, Walgreens has won raves for investing more in the front end of the store, i.e. beauty care, food, toys and other items.

"CVS is missing out on growth that could be easily attained by a slightly more imaginative approach to its front of store business," said Neil Saunders, CEO of retail research firm Conlumino, in a report.

"We continue to be disappointed that the group cannot see the front of house opportunity," he added.

It's a problem that CVS needs to quickly address before the problem gets worse. Customers aren't the only ones that are unhappy. Investors are annoyed too. The stock is now down more than 25% this year.